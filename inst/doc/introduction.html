<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Marian Eberl" />

<meta name="date" content="2020-10-26" />

<title>Introduction to the msSPChelpR package - from long dataset to SIR analyses</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Introduction to the msSPChelpR package - from long dataset to SIR analyses</h1>
<h4 class="author">Marian Eberl</h4>
<h4 class="date">26 October 2020</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette explains how to use the functions:</p>
<ul>
<li><code>calc_futime()</code> to calculate follow-up time from index event until next event, death or end of follow-up date</li>
<li><code>pat_status()</code> to determine patient status at end of follow-up</li>
<li><code>renumber_time_id()</code> to calculate a consecutive index of events per case ID</li>
<li><code>reshape_long()</code> to transpose dataset in wide format to data in long format</li>
<li><code>reshape_wide()</code> to transpose dataset in long format to data in wide format (the wide format is required for many package functions)</li>
<li><code>sir_byfutime()</code> to calculate standardized incidence ratios (SIRs) with custom grouping variables stratified by follow-up time</li>
<li><code>summarize_sir_results()</code> to summarize detailed SIR results produced by <code>sir_byfutime()</code></li>
<li><code>vital_status()</code> to determine vital status whether patient is alive or dead at end of follow-up</li>
</ul>
<p>For some functions there are multiple variants of the same function using varying frameworks. They give the same results but will differ in execution time and memory use:</p>
<ul>
<li><a href="https://markfairbanks.github.io/tidytable/"><code>tidytable</code></a> variants carry the suffix <code>_tt()</code></li>
<li><a href="https://tidyr.tidyverse.org"><code>tidyr</code></a> variants carry the suffix <code>_tidyr()</code></li>
</ul>
</div>
<div id="recommended-workflows" class="section level1">
<h1>Recommended Workflows</h1>
<div id="wf-calc-fu" class="section level2">
<h2>Calculate follow-up times</h2>
<p>It is recommended to run the following steps in the correct order to obtain accurate follow-up time calculations</p>
<ol style="list-style-type: decimal">
<li><p><a href="#step-long">Use the long version dataset</a></p></li>
<li><p><a href="#step-filter">Filter all cases</a> in the long version of the dataset that are relevant for your analysis. Make sure that:</p></li>
</ol>
<ul>
<li>for each <code>case_id</code> the index event (e.g. First Cancer FC) is still included and is the one remaining row in the dataset with the smallest <code>case_id</code> (<code>TUMID3</code> variable for ZfKD data, and <code>SEQ_NUM</code> for SEER data)</li>
<li>all <code>case_id</code>s might or might not get a countable incident event (e.g. Second Primary Cancer SPC). This event should be the second entry per <code>case_id</code> (second smallest <code>case_id</code>) if it is to be counted</li>
<li>in the long version dataset a <code>count_var</code> should indicate whether the countable incident event (SPC) has occurred or not. Coded <code>0</code> for non-occurrence (or not counted event) and <code>1</code> for a counted incident event.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p><a href="#step-renumber">Renumber filtered long dataset</a>: In the filter long dataset, you should run the helper function <code>msSPChelpR::renumber_time_id_dt()</code> (or non-data.table variant <code>msSPChelpR::renumber_time_id()</code>) that will renumber all events per <code>case_id</code> and (if step 1 is fulfilled) will assign each index event with <code>time_var_new = 1</code> and each second (possibly countable incident event) with <code>time_var_new = 2</code>. Any SIR related function will only count the second event, if additionally to <code>time_var_new = 2</code> for this row also <code>count_var = 1</code> is true.</p></li>
<li><p><a href="#step-reshape-wide">Reshape dataset</a>: Run <code>msSPChelpR::reshape_wide_dt()</code> or non-data.table-variant <code>msSPChelpR::reshape_wide()</code>, so that dataset is transposed to wide format (1 row per <code>case_id</code>, creating variables such as <code>count_var.2</code>).</p></li>
<li><p><a href="#step-spc">Set flag for Second Primary Cancer diagnosis</a>: After filtering and reshaping it is essential to set <code>p_spc</code> again. This variable will be used by later steps of the analysis.</p></li>
<li><p><a href="#step-pat-status">Determine patient status</a> at a defined end of follow-up by using the <code>msSPChelpR::pat_status()</code> function. This date for end of follow-up must:</p></li>
</ol>
<ul>
<li><p>be in “YYYY-MM-DD” format and is always defined via the <code>fu_end =</code> parameter</p></li>
<li><p>must precede the end of data collection. E.g. if the last incident events for the dataset you are using are collected at the end of 2014, your <code>fu_end</code> must be <code>fu_end = &quot;2014-12-15&quot;</code> or earlier.</p></li>
<li><p>Based on the newly calculated patient status, you might want to <a href="#step-filter-pat-status">exclude cases for which patient status cannot be determined</a></p></li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li><a href="#step-calc-futime">Calculate follow-up time</a> for the same dataset by using the <code>msSPChelpR::calc_futime()</code> function and the same <code>fu_end</code> as for step 6. By standard all functions of the <code>msSPChelpR</code> package require follow-up times as numeric years.</li>
</ol>
</div>
<div id="calculate-standardized-incidence-ratios-sir" class="section level2">
<h2>Calculate Standardized Incidence Ratios (SIR)</h2>
<p>In order to calculate SIR using the package functions, the following data structure is needed: * Wide format data <code>wide_df</code> with one row per patient that has encountered the index event (i.e. diagnosed with a first primary cancer FC)</p>
<ul>
<li>The dataset <code>wide_df</code> needs to contain the following variables (columns) per patient (row):
<ul>
<li><code>region_var</code> - variable in df that contains information on region where case was incident.</li>
<li><code>agegroup_var</code> - variable in df that contains information on age-group.</li>
<li><code>sex_var</code> - variable in df that contains information on biological sex.</li>
<li><code>year_var</code> - variable in df that contains information on year or year-period when case was incident.</li>
<li><code>site_var</code> - variable in df that contains information on case (count event) diagnosis. Cases are usually the second cancers. Diagnoses can use any coding system (e.g. ICD) but coding system between dataset and reference data must be coherent.</li>
<li><code>futime_var</code> - variable in df that contains follow-up time per person between date of first cancer and any of death, date of event (case), end of FU date (in years; whatever event comes first). In case you have not calculated the FU time yet, you can use the workflow described in the previous <a href="#wf-calc-fu">chapter</a>.</li>
</ul></li>
</ul>
<p>If your data has the required structure, you can calculate and summarize SIRs with the following two steps:</p>
<ol start="8" style="list-style-type: decimal">
<li><a href="#step-sir-byfutime">Calculate SIR</a> per SPC diagnosis with age, sex, region, period-specific strata using the <code>msSPChelpR::sir_byfutime()</code> function. For this calculation usually a reference dataset is required that defines the population standard rates. <code>refrates_df</code> must use the same category coding of age, sex, region, year and cancer_site as <code>agegroup_var</code>, <code>sex_var</code>, <code>region_var</code>, <code>year_var</code> and <code>site_var</code></li>
</ol>
<ul>
<li>The theory behind calculating stratified SIRs is explained in the chapter on <a href="#theo-sir">basics on SIRs</a></li>
</ul>
<ol start="9" style="list-style-type: decimal">
<li><a href="#step-summarize-sir">Summarize SIR results</a> using the <code>msSPChelpR::summarize_sir_results()</code> function on the stratified sir results produced by the previous step.</li>
</ol>
</div>
</div>
<div id="theo-sir" class="section level1">
<h1>Theory behind SIRs</h1>
<p>In the next version of this vignette the theoretical considerations how SIRs are calculated will be explained in this chapter.</p>
</div>
<div id="examples" class="section level1">
<h1>Examples</h1>
<div id="seer-lung-cancer" class="section level2">
<h2>SEER lung cancer</h2>
<div id="step-long" class="section level3">
<h3>Step 1 - Long dataset</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(msSPChelpR)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Load synthetic dataset of patients with cancer to demonstrate package functions</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;us_second_cancer&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#This dataset is in long format, so each tumor is a separate row in the data</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>us_second_cancer</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 113,999 x 15</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id SEQ_NUM registry   sex   race  datebirth  t_datediag t_site_icd t_dco</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004        1 SEER Reg ~ Male  White 1926-01-01 1992-07-15 C50        hist~</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100004        2 SEER Reg ~ Male  White 1926-01-01 2004-01-15 C54        hist~</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100004        3 SEER Reg ~ Male  White 1926-01-01 2006-06-15 C34        hist~</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100004        4 SEER Reg ~ Male  White 1926-01-01 2018-06-15 C14        DCO ~</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100034        1 SEER Reg ~ Male  White 1979-01-01 2000-06-15 C50        hist~</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100037        1 SEER Reg ~ Fema~ White 1938-01-01 1996-01-15 C54        hist~</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100038        1 SEER Reg ~ Male  White 1989-01-01 1991-04-15 C50        hist~</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100038        2 SEER Reg ~ Male  White 1989-01-01 2000-03-15 C80        hist~</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100039        1 SEER Reg ~ Fema~ White 1946-01-01 2003-08-15 C50        hist~</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100039        2 SEER Reg ~ Fema~ White 1946-01-01 2011-04-15 C34        hist~</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 113,989 more rows, and 6 more variables: fc_age &lt;int&gt;,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datedeath &lt;date&gt;, p_alive &lt;chr&gt;, p_dodmin &lt;date&gt;, fc_agegroup &lt;chr&gt;,</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="step-filter" class="section level3">
<h3>Step 2 - Filter long dataset</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter for lung cancer</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> us_second_cancer <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#detect ids with any lung cancer</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t_site_icd <span class="sc">==</span> <span class="st">&quot;C34&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fake_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unname</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>filtered_usdata <span class="ot">&lt;-</span> us_second_cancer <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter according to above detected ids with any lung cancer diagnosis</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fake_id <span class="sc">%in%</span> ids) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(fake_id)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>filtered_usdata</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 62,661 x 15</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id SEQ_NUM registry   sex   race  datebirth  t_datediag t_site_icd t_dco</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004        1 SEER Reg ~ Male  White 1926-01-01 1992-07-15 C50        hist~</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100004        2 SEER Reg ~ Male  White 1926-01-01 2004-01-15 C54        hist~</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100004        3 SEER Reg ~ Male  White 1926-01-01 2006-06-15 C34        hist~</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100004        4 SEER Reg ~ Male  White 1926-01-01 2018-06-15 C14        DCO ~</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100039        1 SEER Reg ~ Fema~ White 1946-01-01 2003-08-15 C50        hist~</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100039        2 SEER Reg ~ Fema~ White 1946-01-01 2011-04-15 C34        hist~</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100039        3 SEER Reg ~ Fema~ White 1946-01-01 2018-01-15 C80        hist~</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100073        1 SEER Reg ~ Male  White 1960-01-01 1993-11-15 C44        hist~</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100073        2 SEER Reg ~ Male  White 1960-01-01 2003-12-15 C34        hist~</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100143        1 SEER Reg ~ Male  White 1944-01-01 1992-03-15 C50        hist~</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 62,651 more rows, and 6 more variables: fc_age &lt;int&gt;,</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datedeath &lt;date&gt;, p_alive &lt;chr&gt;, p_dodmin &lt;date&gt;, fc_agegroup &lt;chr&gt;,</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="step-renumber" class="section level3">
<h3>Step 3 - Renumber <code>time_id</code></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>renumbered_usdata <span class="ot">&lt;-</span> filtered_usdata <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renumber_time_id</span>(<span class="at">new_time_id_var =</span> <span class="st">&quot;t_tumid&quot;</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dattype =</span> <span class="st">&quot;seer&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">case_id_var =</span> <span class="st">&quot;fake_id&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>renumbered_usdata <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(fake_id, sex, t_site_icd, t_datediag, t_tumid)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 62,661 x 5</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id sex    t_site_icd t_datediag t_tumid</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;date&gt;       &lt;int&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004  Male   C50        1992-07-15       1</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100004  Male   C54        2004-01-15       2</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100004  Male   C34        2006-06-15       3</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100004  Male   C14        2018-06-15       4</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100039  Female C50        2003-08-15       1</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100039  Female C34        2011-04-15       2</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100039  Female C80        2018-01-15       3</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100073  Male   C44        1993-11-15       1</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100073  Male   C34        2003-12-15       2</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100143  Male   C50        1992-03-15       1</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 62,651 more rows</span></span></code></pre></div>
</div>
<div id="step-reshape-wide" class="section level3">
<h3>Step 4 - Reshape to wide dataset</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="ot">&lt;-</span> renumbered_usdata <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reshape_wide_tidyr</span>(<span class="at">case_id_var =</span> <span class="st">&quot;fake_id&quot;</span>, <span class="at">time_id_var =</span> <span class="st">&quot;t_tumid&quot;</span>, <span class="at">timevar_max =</span> <span class="dv">10</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#now the data is in the wide format as required by many package functions. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#This means, each case is a row and several tumors per case ID are </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#add new columns to the data using the time_id as column name suffix.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>usdata_wide</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31,997 x 127</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id SEQ_NUM.1 registry.1            sex.1 race.1 datebirth.1 t_datediag.1</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;  &lt;date&gt;      &lt;date&gt;      </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004          1 SEER Reg 20 - Detroi~ Male  White  1926-01-01  1992-07-15  </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100039          1 SEER Reg 02 - Connec~ Fema~ White  1946-01-01  2003-08-15  </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100073          1 SEER Reg 01 - San Fr~ Male  White  1960-01-01  1993-11-15  </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100143          1 SEER Reg 02 - Connec~ Male  White  1944-01-01  1992-03-15  </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100182          1 SEER Reg 02 - Connec~ Male  Other  1927-01-01  1991-09-15  </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100197          1 SEER Reg 02 - Connec~ Fema~ White  1945-01-01  2012-06-15  </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100208          1 SEER Reg 02 - Connec~ Male  White  1970-01-01  2019-11-15  </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100230          1 SEER Reg 01 - San Fr~ Male  White  1947-01-01  1992-11-15  </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100234          1 SEER Reg 01 - San Fr~ Male  White  1988-01-01  2010-02-15  </span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100266          1 SEER Reg 01 - San Fr~ Fema~ White  1956-01-01  2010-07-15  </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 31,987 more rows, and 120 more variables: t_site_icd.1 &lt;chr&gt;,</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.1 &lt;chr&gt;, fc_age.1 &lt;int&gt;, datedeath.1 &lt;date&gt;, p_alive.1 &lt;chr&gt;,</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.1 &lt;date&gt;, fc_agegroup.1 &lt;chr&gt;, t_yeardiag.1 &lt;chr&gt;,</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.2 &lt;int&gt;, registry.2 &lt;chr&gt;, sex.2 &lt;chr&gt;, race.2 &lt;chr&gt;,</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.2 &lt;date&gt;, t_datediag.2 &lt;date&gt;, t_site_icd.2 &lt;chr&gt;, t_dco.2 &lt;chr&gt;,</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_age.2 &lt;int&gt;, datedeath.2 &lt;date&gt;, p_alive.2 &lt;chr&gt;, p_dodmin.2 &lt;date&gt;,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_agegroup.2 &lt;chr&gt;, t_yeardiag.2 &lt;chr&gt;, SEQ_NUM.3 &lt;int&gt;, registry.3 &lt;chr&gt;,</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   sex.3 &lt;chr&gt;, race.3 &lt;chr&gt;, datebirth.3 &lt;date&gt;, t_datediag.3 &lt;date&gt;,</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_site_icd.3 &lt;chr&gt;, t_dco.3 &lt;chr&gt;, fc_age.3 &lt;int&gt;, datedeath.3 &lt;date&gt;,</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_alive.3 &lt;chr&gt;, p_dodmin.3 &lt;date&gt;, fc_agegroup.3 &lt;chr&gt;,</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag.3 &lt;chr&gt;, SEQ_NUM.4 &lt;int&gt;, registry.4 &lt;chr&gt;, sex.4 &lt;chr&gt;,</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   race.4 &lt;chr&gt;, datebirth.4 &lt;date&gt;, t_datediag.4 &lt;date&gt;, t_site_icd.4 &lt;chr&gt;,</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.4 &lt;chr&gt;, fc_age.4 &lt;int&gt;, datedeath.4 &lt;date&gt;, p_alive.4 &lt;chr&gt;,</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.4 &lt;date&gt;, fc_agegroup.4 &lt;chr&gt;, t_yeardiag.4 &lt;chr&gt;,</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.5 &lt;int&gt;, registry.5 &lt;chr&gt;, sex.5 &lt;chr&gt;, race.5 &lt;chr&gt;,</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.5 &lt;date&gt;, t_datediag.5 &lt;date&gt;, t_site_icd.5 &lt;chr&gt;, t_dco.5 &lt;chr&gt;,</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_age.5 &lt;int&gt;, datedeath.5 &lt;date&gt;, p_alive.5 &lt;chr&gt;, p_dodmin.5 &lt;date&gt;,</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_agegroup.5 &lt;chr&gt;, t_yeardiag.5 &lt;chr&gt;, SEQ_NUM.6 &lt;int&gt;, registry.6 &lt;chr&gt;,</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   sex.6 &lt;chr&gt;, race.6 &lt;chr&gt;, datebirth.6 &lt;date&gt;, t_datediag.6 &lt;date&gt;,</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_site_icd.6 &lt;chr&gt;, t_dco.6 &lt;chr&gt;, fc_age.6 &lt;int&gt;, datedeath.6 &lt;date&gt;,</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_alive.6 &lt;chr&gt;, p_dodmin.6 &lt;date&gt;, fc_agegroup.6 &lt;chr&gt;,</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag.6 &lt;chr&gt;, SEQ_NUM.7 &lt;int&gt;, registry.7 &lt;chr&gt;, sex.7 &lt;chr&gt;,</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   race.7 &lt;chr&gt;, datebirth.7 &lt;date&gt;, t_datediag.7 &lt;date&gt;, t_site_icd.7 &lt;chr&gt;,</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.7 &lt;chr&gt;, fc_age.7 &lt;int&gt;, datedeath.7 &lt;date&gt;, p_alive.7 &lt;chr&gt;,</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.7 &lt;date&gt;, fc_agegroup.7 &lt;chr&gt;, t_yeardiag.7 &lt;chr&gt;,</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.8 &lt;int&gt;, registry.8 &lt;chr&gt;, sex.8 &lt;chr&gt;, race.8 &lt;chr&gt;,</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.8 &lt;date&gt;, t_datediag.8 &lt;date&gt;, t_site_icd.8 &lt;chr&gt;, t_dco.8 &lt;chr&gt;,</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ...</span></span></code></pre></div>
</div>
<div id="step-spc" class="section level3">
<h3>Step 5 - Recalculate <code>p_spc</code></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="ot">&lt;-</span> usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">p_spc =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(<span class="fu">is.na</span>(t_site_icd<span class="fl">.2</span>)   <span class="sc">~</span> <span class="st">&quot;No SPC&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">is.na</span>(t_site_icd<span class="fl">.2</span>)           <span class="sc">~</span> <span class="st">&quot;SPC developed&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create the same information as numeric variable count_spc</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">count_spc =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(<span class="fu">is.na</span>(t_site_icd<span class="fl">.2</span>)   <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(fake_id, sex<span class="fl">.1</span>, p_spc, count_spc, t_site_icd<span class="fl">.1</span>, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                 t_datediag<span class="fl">.1</span>, t_site_icd<span class="fl">.2</span>, t_datediag<span class="fl">.2</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31,997 x 8</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id sex.1  p_spc         count_spc t_site_icd.1 t_datediag.1 t_site_icd.2</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;        &lt;date&gt;       &lt;chr&gt;       </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004  Male   SPC developed         0 C50          1992-07-15   C54         </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100039  Female SPC developed         0 C50          2003-08-15   C34         </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100073  Male   SPC developed         0 C44          1993-11-15   C34         </span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100143  Male   SPC developed         0 C50          1992-03-15   C34         </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100182  Male   SPC developed         0 C18          1991-09-15   C34         </span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100197  Female SPC developed         0 C34          2012-06-15   C50         </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100208  Male   No SPC                1 C34          2019-11-15   &lt;NA&gt;        </span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100230  Male   SPC developed         0 C44          1992-11-15   C34         </span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100234  Male   No SPC                1 C34          2010-02-15   &lt;NA&gt;        </span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100266  Female No SPC                1 C34          2010-07-15   &lt;NA&gt;        </span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 31,987 more rows, and 1 more variable: t_datediag.2 &lt;date&gt;</span></span></code></pre></div>
</div>
<div id="step-pat-status" class="section level3">
<h3>Step 6 - Determine patient status at end of FU</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="ot">&lt;-</span> usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pat_status</span>(., <span class="at">fu_end =</span> <span class="st">&quot;2017-12-31&quot;</span>, <span class="at">dattype =</span> <span class="st">&quot;seer&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">status_var =</span> <span class="st">&quot;p_status&quot;</span>, <span class="at">life_var =</span> <span class="st">&quot;p_alive.1&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">spc_var =</span> <span class="st">&quot;p_spc&quot;</span>, <span class="at">birthdat_var =</span> <span class="st">&quot;datebirth.1&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lifedat_var =</span> <span class="st">&quot;datedeath.1&quot;</span>, <span class="at">fcdat_var =</span> <span class="st">&quot;t_datediag.1&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">spcdat_var =</span> <span class="st">&quot;t_datediag.2&quot;</span>, <span class="at">life_stat_alive =</span> <span class="st">&quot;Alive&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">life_stat_dead =</span> <span class="st">&quot;Dead&quot;</span>, <span class="at">spc_stat_yes =</span> <span class="st">&quot;SPC developed&quot;</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">spc_stat_no =</span> <span class="st">&quot;No SPC&quot;</span>, <span class="at">lifedat_fu_end =</span> <span class="st">&quot;2019-12-31&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">use_lifedatmin =</span> <span class="cn">FALSE</span>, <span class="at">check =</span> <span class="cn">TRUE</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">as_labelled_factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 x 3</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    p_alive.1 p_status                                                          n</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;fct&gt;                                                         &lt;int&gt;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alive     Patient alive after FC (with or without following SPC after ~  5940</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alive     Patient alive after SPC                                       11316</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alive     NA - Patient not born before end of FU                            4</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alive     NA - Patient did not develop cancer before end of FU            849</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Dead      Patient alive after FC (with or without following SPC after ~   863</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Dead      Patient alive after SPC                                        1360</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Dead      Patient dead after FC                                          6208</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Dead      Patient dead after SPC                                         5325</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Dead      NA - Patient did not develop cancer before end of FU             68</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Dead      NA - Patient date of death is missing                            64</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 x 2</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   p_status                                                                   n</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;                                                                  &lt;int&gt;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Patient alive after FC (with or without following SPC after end of FU)  6803</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Patient alive after SPC                                                12676</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Patient dead after FC                                                   6208</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Patient dead after SPC                                                  5325</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 NA - Patient not born before end of FU                                     4</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 NA - Patient did not develop cancer before end of FU                     917</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 NA - Patient date of death is missing                                     64</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(fake_id, p_status, p_alive<span class="fl">.1</span>, datedeath<span class="fl">.1</span>, t_site_icd<span class="fl">.1</span>, t_datediag<span class="fl">.1</span>, </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                 t_site_icd<span class="fl">.2</span>, t_datediag<span class="fl">.2</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31,997 x 8</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id p_status p_alive.1 datedeath.1 t_site_icd.1 t_datediag.1 t_site_icd.2</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;fct&gt;    &lt;chr&gt;     &lt;date&gt;      &lt;chr&gt;        &lt;date&gt;       &lt;chr&gt;       </span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004  Patient~ Alive     NA          C50          1992-07-15   C54         </span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100039  Patient~ Alive     NA          C50          2003-08-15   C34         </span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100073  Patient~ Dead      2005-06-01  C44          1993-11-15   C34         </span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100143  Patient~ Alive     NA          C50          1992-03-15   C34         </span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100182  Patient~ Dead      2007-05-01  C18          1991-09-15   C34         </span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100197  Patient~ Alive     NA          C34          2012-06-15   C50         </span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100208  NA - Pa~ Alive     NA          C34          2019-11-15   &lt;NA&gt;        </span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100230  Patient~ Dead      2008-05-01  C44          1992-11-15   C34         </span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100234  Patient~ Dead      2015-07-01  C34          2010-02-15   &lt;NA&gt;        </span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100266  Patient~ Alive     NA          C34          2010-07-15   &lt;NA&gt;        </span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 31,987 more rows, and 1 more variable: t_datediag.2 &lt;date&gt;</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">#alternatively, you can impute the date of death using lifedatmin_var</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pat_status</span>(., <span class="at">fu_end =</span> <span class="st">&quot;2017-12-31&quot;</span>, <span class="at">dattype =</span> <span class="st">&quot;seer&quot;</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">status_var =</span> <span class="st">&quot;p_status&quot;</span>, <span class="at">life_var =</span> <span class="st">&quot;p_alive.1&quot;</span>,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">spc_var =</span> <span class="st">&quot;p_spc&quot;</span>, <span class="at">birthdat_var =</span> <span class="st">&quot;datebirth.1&quot;</span>,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>             <span class="at">lifedat_var =</span> <span class="st">&quot;datedeath.1&quot;</span>, <span class="at">fcdat_var =</span> <span class="st">&quot;t_datediag.1&quot;</span>,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>             <span class="at">spcdat_var =</span> <span class="st">&quot;t_datediag.2&quot;</span>, <span class="at">life_stat_alive =</span> <span class="st">&quot;Alive&quot;</span>,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>             <span class="at">life_stat_dead =</span> <span class="st">&quot;Dead&quot;</span>, <span class="at">spc_stat_yes =</span> <span class="st">&quot;SPC developed&quot;</span>,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>             <span class="at">spc_stat_no =</span> <span class="st">&quot;No SPC&quot;</span>, <span class="at">lifedat_fu_end =</span> <span class="st">&quot;2019-12-31&quot;</span>,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>             <span class="at">use_lifedatmin =</span> <span class="cn">TRUE</span>, <span class="at">lifedatmin_var =</span> <span class="st">&quot;p_dodmin.1&quot;</span>, </span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>             <span class="at">check =</span> <span class="cn">TRUE</span>, <span class="at">as_labelled_factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9 x 3</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   p_alive.1 p_status                                                           n</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;fct&gt;                                                          &lt;int&gt;</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Alive     Patient alive after FC (with or without following SPC after e~  5940</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alive     Patient alive after SPC                                        11316</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Alive     NA - Patient not born before end of FU                             4</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Alive     NA - Patient did not develop cancer before end of FU             849</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Dead      Patient alive after FC (with or without following SPC after e~   867</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Dead      Patient alive after SPC                                         1361</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 Dead      Patient dead after FC                                           6230</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 Dead      Patient dead after SPC                                          5362</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9 Dead      NA - Patient did not develop cancer before end of FU              68</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   p_status                                                                   n</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;                                                                  &lt;int&gt;</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Patient alive after FC (with or without following SPC after end of FU)  6807</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Patient alive after SPC                                                12677</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Patient dead after FC                                                   6230</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Patient dead after SPC                                                  5362</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 NA - Patient not born before end of FU                                     4</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 NA - Patient did not develop cancer before end of FU                     917</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31,997 x 130</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id SEQ_NUM.1 registry.1            sex.1 race.1 datebirth.1 t_datediag.1</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;  &lt;date&gt;      &lt;date&gt;      </span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004          1 SEER Reg 20 - Detroi~ Male  White  1926-01-01  1992-07-15  </span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100039          1 SEER Reg 02 - Connec~ Fema~ White  1946-01-01  2003-08-15  </span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100073          1 SEER Reg 01 - San Fr~ Male  White  1960-01-01  1993-11-15  </span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100143          1 SEER Reg 02 - Connec~ Male  White  1944-01-01  1992-03-15  </span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100182          1 SEER Reg 02 - Connec~ Male  Other  1927-01-01  1991-09-15  </span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100197          1 SEER Reg 02 - Connec~ Fema~ White  1945-01-01  2012-06-15  </span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100208          1 SEER Reg 02 - Connec~ Male  White  1970-01-01  2019-11-15  </span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100230          1 SEER Reg 01 - San Fr~ Male  White  1947-01-01  1992-11-15  </span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100234          1 SEER Reg 01 - San Fr~ Male  White  1988-01-01  2010-02-15  </span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100266          1 SEER Reg 01 - San Fr~ Fema~ White  1956-01-01  2010-07-15  </span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 31,987 more rows, and 123 more variables: t_site_icd.1 &lt;chr&gt;,</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.1 &lt;chr&gt;, fc_age.1 &lt;int&gt;, datedeath.1 &lt;date&gt;, p_alive.1 &lt;chr&gt;,</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.1 &lt;date&gt;, fc_agegroup.1 &lt;chr&gt;, t_yeardiag.1 &lt;chr&gt;,</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.2 &lt;int&gt;, registry.2 &lt;chr&gt;, sex.2 &lt;chr&gt;, race.2 &lt;chr&gt;,</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.2 &lt;date&gt;, t_datediag.2 &lt;date&gt;, t_site_icd.2 &lt;chr&gt;, t_dco.2 &lt;chr&gt;,</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_age.2 &lt;int&gt;, datedeath.2 &lt;date&gt;, p_alive.2 &lt;chr&gt;, p_dodmin.2 &lt;date&gt;,</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_agegroup.2 &lt;chr&gt;, t_yeardiag.2 &lt;chr&gt;, SEQ_NUM.3 &lt;int&gt;, registry.3 &lt;chr&gt;,</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   sex.3 &lt;chr&gt;, race.3 &lt;chr&gt;, datebirth.3 &lt;date&gt;, t_datediag.3 &lt;date&gt;,</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_site_icd.3 &lt;chr&gt;, t_dco.3 &lt;chr&gt;, fc_age.3 &lt;int&gt;, datedeath.3 &lt;date&gt;,</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_alive.3 &lt;chr&gt;, p_dodmin.3 &lt;date&gt;, fc_agegroup.3 &lt;chr&gt;,</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag.3 &lt;chr&gt;, SEQ_NUM.4 &lt;int&gt;, registry.4 &lt;chr&gt;, sex.4 &lt;chr&gt;,</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   race.4 &lt;chr&gt;, datebirth.4 &lt;date&gt;, t_datediag.4 &lt;date&gt;, t_site_icd.4 &lt;chr&gt;,</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.4 &lt;chr&gt;, fc_age.4 &lt;int&gt;, datedeath.4 &lt;date&gt;, p_alive.4 &lt;chr&gt;,</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.4 &lt;date&gt;, fc_agegroup.4 &lt;chr&gt;, t_yeardiag.4 &lt;chr&gt;,</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.5 &lt;int&gt;, registry.5 &lt;chr&gt;, sex.5 &lt;chr&gt;, race.5 &lt;chr&gt;,</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.5 &lt;date&gt;, t_datediag.5 &lt;date&gt;, t_site_icd.5 &lt;chr&gt;, t_dco.5 &lt;chr&gt;,</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_age.5 &lt;int&gt;, datedeath.5 &lt;date&gt;, p_alive.5 &lt;chr&gt;, p_dodmin.5 &lt;date&gt;,</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   fc_agegroup.5 &lt;chr&gt;, t_yeardiag.5 &lt;chr&gt;, SEQ_NUM.6 &lt;int&gt;, registry.6 &lt;chr&gt;,</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   sex.6 &lt;chr&gt;, race.6 &lt;chr&gt;, datebirth.6 &lt;date&gt;, t_datediag.6 &lt;date&gt;,</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_site_icd.6 &lt;chr&gt;, t_dco.6 &lt;chr&gt;, fc_age.6 &lt;int&gt;, datedeath.6 &lt;date&gt;,</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_alive.6 &lt;chr&gt;, p_dodmin.6 &lt;date&gt;, fc_agegroup.6 &lt;chr&gt;,</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_yeardiag.6 &lt;chr&gt;, SEQ_NUM.7 &lt;int&gt;, registry.7 &lt;chr&gt;, sex.7 &lt;chr&gt;,</span></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   race.7 &lt;chr&gt;, datebirth.7 &lt;date&gt;, t_datediag.7 &lt;date&gt;, t_site_icd.7 &lt;chr&gt;,</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   t_dco.7 &lt;chr&gt;, fc_age.7 &lt;int&gt;, datedeath.7 &lt;date&gt;, p_alive.7 &lt;chr&gt;,</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   p_dodmin.7 &lt;date&gt;, fc_agegroup.7 &lt;chr&gt;, t_yeardiag.7 &lt;chr&gt;,</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SEQ_NUM.8 &lt;int&gt;, registry.8 &lt;chr&gt;, sex.8 &lt;chr&gt;, race.8 &lt;chr&gt;,</span></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   datebirth.8 &lt;date&gt;, t_datediag.8 &lt;date&gt;, t_site_icd.8 &lt;chr&gt;, t_dco.8 &lt;chr&gt;,</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ...</span></span></code></pre></div>
<div id="step-filter-pat-status" class="section level4">
<h4>Step 6b - Remove patients irrelevant to analysis depending on status</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="ot">&lt;-</span> usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>p_status <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;NA - Patient not born before end of FU&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;NA - Patient did not develop cancer before end of FU&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;NA - Patient date of death is missing&quot;</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(p_status)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   p_status                                                                   n</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;                                                                  &lt;int&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Patient alive after FC (with or without following SPC after end of FU)  6803</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Patient alive after SPC                                                12676</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Patient dead after FC                                                   6208</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Patient dead after SPC                                                  5325</span></span></code></pre></div>
</div>
</div>
<div id="step-calc-futime" class="section level3">
<h3>Step 7 - Calculate FU time</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="ot">&lt;-</span> usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">calc_futime</span>(., <span class="at">futime_var_new =</span> <span class="st">&quot;p_futimeyrs&quot;</span>, <span class="at">fu_end =</span> <span class="st">&quot;2017-12-31&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">dattype =</span> <span class="st">&quot;seer&quot;</span>, <span class="at">time_unit =</span> <span class="st">&quot;years&quot;</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">lifedat_var =</span> <span class="st">&quot;datedeath.1&quot;</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">fcdat_var =</span> <span class="st">&quot;t_datediag.1&quot;</span>, <span class="at">spcdat_var =</span> <span class="st">&quot;t_datediag.2&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   p_status                       mean_futime min_futime max_futime median_futime</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;                                &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Patient alive after FC (with ~        9.58     0.0438       27.0          8.29</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Patient alive after SPC               8.69     0            26.9          7.50</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Patient dead after FC                 8.54     0            25.8          7.47</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Patient dead after SPC                6.33     0            26.5          5.08</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(fake_id, p_status, p_futimeyrs, p_alive<span class="fl">.1</span>, datedeath<span class="fl">.1</span>, t_datediag<span class="fl">.1</span>, t_datediag<span class="fl">.2</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 31,012 x 7</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fake_id p_status  p_futimeyrs p_alive.1 datedeath.1 t_datediag.1 t_datediag.2</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;fct&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;date&gt;      &lt;date&gt;       &lt;date&gt;      </span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100004  Patient ~       11.5  Alive     NA          1992-07-15   2004-01-15  </span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100039  Patient ~        7.67 Alive     NA          2003-08-15   2011-04-15  </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100073  Patient ~       10.1  Dead      2005-06-01  1993-11-15   2003-12-15  </span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100143  Patient ~        3.33 Alive     NA          1992-03-15   1995-07-15  </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100182  Patient ~        7.08 Dead      2007-05-01  1991-09-15   1998-10-15  </span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100197  Patient ~        4.83 Alive     NA          2012-06-15   2017-04-15  </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100230  Patient ~       11.0  Dead      2008-05-01  1992-11-15   2003-11-15  </span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100234  Patient ~        5.37 Dead      2015-07-01  2010-02-15   NA          </span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100266  Patient ~        7.46 Alive     NA          2010-07-15   NA          </span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100274  Patient ~        2.38 Dead      2006-06-01  2004-01-15   NA          </span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 31,002 more rows</span></span></code></pre></div>
</div>
<div id="step-sir-byfutime" class="section level3">
<h3>Step 8 - Calculate SIR</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sircalc_results <span class="ot">&lt;-</span> usdata_wide <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sir_byfutime</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">dattype =</span> <span class="st">&quot;seer&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ybreak_vars =</span> <span class="fu">c</span>(<span class="st">&quot;race.1&quot;</span>, <span class="st">&quot;t_dco.1&quot;</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">xbreak_var =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">futime_breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="cn">Inf</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_var =</span> <span class="st">&quot;count_spc&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">refrates_df =</span> us_refrates_icd2,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc_total_row =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc_total_fu =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_var =</span> <span class="st">&quot;registry.1&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_var =</span> <span class="st">&quot;fc_agegroup.1&quot;</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_var =</span> <span class="st">&quot;sex.1&quot;</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_var =</span> <span class="st">&quot;t_yeardiag.1&quot;</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_var =</span> <span class="st">&quot;t_site_icd.1&quot;</span>, <span class="co">#using grouping by second cancer incidence</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">futime_var =</span> <span class="st">&quot;p_futimeyrs&quot;</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [INFO Cases 0 PYARs] There are conflicts where strata with 0 follow-up time have data in observed. </span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 4 x 10</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   age    sex    region     year  race.1 t_site to1month i_observed i_pyar n_base</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 05 - ~ Male   SEER Reg ~ 2015~ Other  C34           1          1      0      1</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 15 - ~ Male   SEER Reg ~ 2005~ Black  C34           1          1      0      1</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 85 - ~ Female SEER Reg ~ 1995~ Black  C34           1          2      0      2</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 85 - ~ Male   SEER Reg ~ 2010~ Other  C34           1          1      0      1 </span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Check attribute `problems_not_empty` of results to see what strata are affected. </span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This might be caused by cases where SPC occured at the same day as first cancer. </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You can check this by excluding all cases from wide_df, where date of first diagnosis is equal.</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [INFO Cases 0 PYARs] There are conflicts where strata with 0 follow-up time have data in observed. </span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 4 x 10</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   age    sex    region    year  race.1 t_site Total0toInfyears i_observed i_pyar</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 05 - ~ Male   SEER Reg~ 2015~ Other  C34                   1          1      0</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 15 - ~ Male   SEER Reg~ 2005~ Black  C34                   1          1      0</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 85 - ~ Female SEER Reg~ 1995~ Black  C34                   1          2      0</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 85 - ~ Male   SEER Reg~ 2010~ Other  C34                   1          1      0</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 1 more variable: n_base &lt;dbl&gt; </span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Check attribute `problems_not_empty` of results to see what strata are affected. </span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This might be caused by cases where SPC occured at the same day as first cancer. </span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You can check this by excluding all cases from wide_df, where date of first diagnosis is equal.</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [INFO Cases 0 PYARs] There are conflicts where strata with 0 follow-up time have data in observed. </span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 1 x 10</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   age    sex   region     year  t_dco.1 t_site to1month i_observed i_pyar n_base</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 80 - ~ Male  SEER Reg ~ 2010~ DCO ca~ C34           1          1      0      1 </span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Check attribute `problems_not_empty` of results to see what strata are affected. </span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This might be caused by cases where SPC occured at the same day as first cancer. </span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You can check this by excluding all cases from wide_df, where date of first diagnosis is equal.</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [INFO Cases 0 PYARs] There are conflicts where strata with 0 follow-up time have data in observed. </span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 1 x 10</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   age    sex   region    year  t_dco.1 t_site Total0toInfyears i_observed i_pyar</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 80 - ~ Male  SEER Reg~ 2010~ DCO ca~ C34                   1          1      0</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 1 more variable: n_base &lt;dbl&gt; </span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Check attribute `problems_not_empty` of results to see what strata are affected. </span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This might be caused by cases where SPC occured at the same day as first cancer. </span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You can check this by excluding all cases from wide_df, where date of first diagnosis is equal.</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  There are observed cases in the results file that do not occur in the refrates_df. </span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; A possible explanation can be: </span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - DCO cases </span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - diagnosis of second cancer occured in different time period than first cancer </span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following strata are affected: </span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 166 x 21</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    yvar_name yvar_label fu_time  age    sex   region     year  t_site i_observed</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 total_var Overall    1-5 yea~ 60 - ~ Male  SEER Reg ~ 2010~ C34            17</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 total_var Overall    1-5 yea~ 65 - ~ Male  SEER Reg ~ 2015~ C34            18</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 total_var Overall    5-10 ye~ 60 - ~ Male  SEER Reg ~ 2010~ C34            20</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 total_var Overall    5-10 ye~ 60 - ~ Male  SEER Reg ~ 2010~ C34            22</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 total_var Overall    5-10 ye~ 70 - ~ Male  SEER Reg ~ 2005~ C34            12</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 total_var Overall    5-10 ye~ 75 - ~ Fema~ SEER Reg ~ 2005~ C34            13</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 total_var Overall    10+ yea~ 25 - ~ Fema~ SEER Reg ~ 1995~ C34            14</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 total_var Overall    10+ yea~ 60 - ~ Fema~ SEER Reg ~ 1995~ C34            18</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 total_var Overall    10+ yea~ 60 - ~ Fema~ SEER Reg ~ 1995~ C34            16</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 total_var Overall    10+ yea~ 65 - ~ Male  SEER Reg ~ 2000~ C34            29</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 156 more rows, and 12 more variables: i_pyar &lt;dbl&gt;, n_base &lt;dbl&gt;,</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   race &lt;chr&gt;, incidence_cases &lt;int&gt;, population_pyar &lt;int&gt;,</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   incidence_crude_rate &lt;dbl&gt;, i_expected &lt;dbl&gt;, sir &lt;dbl&gt;, sir_lci &lt;dbl&gt;,</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   sir_uci &lt;dbl&gt;, fu_time_sort &lt;int&gt;, yvar_sort &lt;int&gt;</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Check attribute `notes_refcases` of results to see what strata are affected.</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="co"># sircalc_results %&gt;% print(n = 100) # uncomment after tidytable 0.5.6 release</span></span></code></pre></div>
</div>
<div id="step-summarize-sir" class="section level3">
<h3>Step 9 - Summarize SIR results</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The summarize function is versatile. Her for example the summary by</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sircalc_results <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summarize results across region, age, year and t_site</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_sir_results</span>(.,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">summarize_groups =</span> <span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;race&quot;</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">summarize_site =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">output =</span> <span class="st">&quot;long&quot;</span>,  <span class="at">output_information =</span> <span class="st">&quot;minimal&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">add_total_row =</span> <span class="st">&quot;only&quot;</span>,  <span class="at">add_total_fu =</span> <span class="st">&quot;no&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">collapse_ci =</span> <span class="cn">FALSE</span>,  <span class="at">shorten_total_cols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fubreak_var_name =</span> <span class="st">&quot;fu_time&quot;</span>, <span class="at">ybreak_var_name =</span> <span class="st">&quot;yvar_name&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">xbreak_var_name =</span> <span class="st">&quot;none&quot;</span>, <span class="at">site_var_name =</span> <span class="st">&quot;t_site&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">alpha =</span> <span class="fl">0.05</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                        ) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>region, <span class="sc">-</span>age, <span class="sc">-</span>year, <span class="sc">-</span>race, <span class="sc">-</span>sex, <span class="sc">-</span>yvar_name)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: The results file `sir_df` contains observed cases in i_observed that do not occur in the refrates_df (ref_inc_cases).</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Therefore calculation of the variables n_base and ref_population_pyar is ambiguous. </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; We take the first value of each variable. Expect small inconsistencies in the calculation of n_base, ref_population_pyar and ref_inc_crude_rate across strata. </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; If you want to know more, please check the `warnings` column of `sir_df`.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tidytable: 7 x 8</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   yvar_label fu_time       fu_time_sort t_site observed expected   sir sir_ci   </span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;                &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Overall    to 1 month               1 Total       327     18.1 18.1  16.19 - ~</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Overall    0.0833-0.167~            2 Total        80     17.9  4.46 3.54 - 5~</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Overall    0.167-1 years            3 Total       724    172.   4.2  3.9 - 4.~</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Overall    1-5 years                4 Total      2998    668.   4.49 4.33 - 4~</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Overall    5-10 years               5 Total      3089    531.   5.82 5.61 - 6~</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Overall    10+ years                6 Total      4241    438.   9.69 9.4 - 9.~</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 Overall    Total 0 to I~            7 Total     11459   1845.   6.21 6.1 - 6.~</span></span></code></pre></div>
</div>
</div>
<div id="built-with" class="section level2">
<h2>Built with</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; R version 4.0.5 (2021-03-31)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Running under: Windows 10 x64 (build 17763)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Matrix products: default</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; locale:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] LC_COLLATE=C                    LC_CTYPE=German_Germany.1252   </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] LC_TIME=German_Germany.1252    </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attached base packages:</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other attached packages:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] msSPChelpR_0.8.7 magrittr_2.0.1   dplyr_1.0.6     </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] Rcpp_1.0.6        pillar_1.6.1      bslib_0.2.5.1     compiler_4.0.5   </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] jquerylib_0.1.4   prettyunits_1.1.1 progress_1.2.2    forcats_0.5.1    </span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] tools_4.0.5       digest_0.6.27     jsonlite_1.7.2    lubridate_1.7.10 </span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] evaluate_0.14     lifecycle_1.0.0   tibble_3.1.2      pkgconfig_2.0.3  </span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] rlang_0.4.11      DBI_1.1.1         cli_2.5.0         rstudioapi_0.13  </span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] yaml_2.2.1        haven_2.4.1       xfun_0.23         stringr_1.4.0    </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] knitr_1.33        hms_1.1.0         generics_0.1.0    vctrs_0.3.8      </span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29] sass_0.4.0        sjlabelled_1.1.8  tidyselect_1.1.1  snakecase_0.11.0 </span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [33] glue_1.4.2        data.table_1.14.0 R6_2.5.0          fansi_0.5.0      </span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37] rmarkdown_2.9     purrr_0.3.4       tidyr_1.1.3       ps_1.6.0         </span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] ellipsis_0.3.2    htmltools_0.5.1.1 insight_0.14.1    assertthat_0.2.1 </span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [45] tidytable_0.6.2   utf8_1.2.1        stringi_1.6.2     crayon_1.4.1</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
